<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>年間カレンダー</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <header class="app-header">
      <h1>年間カレンダー</h1>
      <form id="yearForm" class="year-form">
        <label for="yearInput">年を選択:</label>
        <input type="number" id="yearInput" name="year" min="1" max="9999" step="1" />
        <button type="submit" class="year-form__submit">表示</button>
        <span aria-hidden="true" class="year-form__divider">|</span>
        <button type="button" id="yearChartTrigger" class="year-form__chart-button">
          年間推移
        </button>
        <p id="yearError" class="form-error" aria-live="polite"></p>
      </form>
    </header>

    <main>
      <section class="upload-placeholder" aria-labelledby="csvSectionTitle">
        <h2 id="csvSectionTitle">CSVファイルの指定</h2>
        <p class="upload-placeholder__description">
          デフォルトではソースの <code>public/data/dummy_kabucom.csv</code>（ビルド後は
          <code>dist/data/dummy_kabucom.csv</code>）を既定データとして参照します。別のCSVを解析したい場合は、ファイル選択ボタンからアップロードしてください。
        </p>
        <div class="csv-upload">
          <input
            type="file"
            id="csvFileInput"
            class="csv-upload__input"
            accept=".csv,text/csv"
            aria-describedby="csvStatus csvError"
          />
          <label
            for="csvFileInput"
            class="csv-upload__trigger"
            role="button"
            tabindex="0"
            data-csv-trigger
          >
            CSVファイルを選択
          </label>
          <span id="csvFileName" class="csv-upload__filename" aria-live="polite">未選択</span>
          <button type="button" id="csvResetButton" class="csv-upload__reset">既定データに戻す</button>
        </div>
        <p id="csvStatus" class="csv-upload__status" aria-live="polite"></p>
        <p id="csvError" class="form-error" aria-live="polite"></p>

        <div class="spreadsheet-section" aria-labelledby="spreadsheetSectionTitle">
          <h3 id="spreadsheetSectionTitle">スプレッドシートから取得</h3>
          <p class="spreadsheet-section__description">
            Google Apps Script のエンドポイントを指定して、スプレッドシートから暗号化済みのデータを直接取得します。利用したURLはブラウザに保存されます。
          </p>
          <label for="spreadsheetEndpointInput" class="spreadsheet-section__label">
            GASエンドポイント
          </label>
          <div class="spreadsheet-section__controls">
            <input
              type="url"
              id="spreadsheetEndpointInput"
              name="spreadsheetEndpoint"
              placeholder="https://script.google.com/macros/s/xxxx/exec"
              aria-describedby="spreadsheetStatus spreadsheetError"
              inputmode="url"
            />
            <button type="button" id="spreadsheetFetchButton" class="spreadsheet-section__action">
              取得して反映
            </button>
            <button
              type="button"
              id="spreadsheetResetButton"
              class="spreadsheet-section__secondary"
            >
              エンドポイントをクリア
            </button>
          </div>
          <div class="spreadsheet-section__psk">
            <label for="spreadsheetPskInput" class="spreadsheet-section__label">PSK</label>
            <input
              type="password"
              id="spreadsheetPskInput"
              name="spreadsheetPsk"
              placeholder="共有鍵を入力"
              aria-describedby="spreadsheetStatus spreadsheetError"
              autocomplete="current-password"
            />
            <input type="checkbox" id="spreadsheetSavePskCheckbox" />
            <label for="spreadsheetSavePskCheckbox" class="spreadsheet-section__save">
              このブラウザにPSKを保存する（注意：平文で保存され、暗号化はされません）
            </label>
          </div>
          <p id="spreadsheetStatus" class="spreadsheet-section__status" aria-live="polite"></p>
          <p id="spreadsheetError" class="form-error" aria-live="polite"></p>
        </div>
      </section>

      <section id="calendar" class="calendar-grid" aria-live="polite"></section>
    </main>

    <div
      id="monthModal"
      class="month-modal"
      aria-hidden="true"
      role="dialog"
      aria-label="月の拡大表示"
    >
      <div class="month-modal__backdrop" data-modal-close></div>
      <div class="month-modal__dialog">
        <button
          type="button"
          id="modalCloseButton"
          class="month-modal__close"
          aria-label="閉じる"
          data-modal-close
        >
          ×
        </button>
        <div id="modalCalendarContainer" class="month-modal__calendar"></div>
      </div>
    </div>

    <div
      id="yearChartModal"
      class="year-chart-modal"
      aria-hidden="true"
      role="dialog"
      aria-label="年間損益グラフ"
    >
      <div class="year-chart-modal__backdrop" data-year-chart-close></div>
      <div class="year-chart-modal__dialog">
        <button
          type="button"
          id="yearChartCloseButton"
          class="year-chart-modal__close"
          aria-label="閉じる"
          data-year-chart-close
        >
          ×
        </button>
        <div id="yearChartContainer" class="year-chart-modal__content"></div>
      </div>
    </div>

    <div
      id="chartZoomModal"
      class="chart-zoom-modal"
      aria-hidden="true"
      role="dialog"
      aria-labelledby="chartZoomTitle"
    >
      <div class="chart-zoom-modal__backdrop" data-chart-zoom-close></div>
      <div class="chart-zoom-modal__dialog">
        <button
          type="button"
          id="chartZoomCloseButton"
          class="chart-zoom-modal__close"
          aria-label="閉じる"
          data-chart-zoom-close
        >
          ×
        </button>
        <div class="chart-zoom-modal__content">
          <h2 id="chartZoomTitle" class="chart-zoom-modal__title">グラフの拡大表示</h2>
          <div id="chartZoomContainer" class="chart-zoom-modal__chart"></div>
        </div>
      </div>
    </div>

    <template id="monthTemplate">
      <article class="calendar-month">
        <header class="month-header"></header>
        <table>
          <caption class="month-caption"></caption>
          <thead>
            <tr class="weekday-row"></tr>
          </thead>
          <tbody class="weeks"></tbody>
        </table>
      </article>
    </template>

    <script src="./main.ts" type="module"></script>
  </body>
</html>
